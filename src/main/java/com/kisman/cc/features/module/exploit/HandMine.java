package com.kisman.cc.features.module.exploit;

import com.kisman.cc.Kisman;
import com.kisman.cc.event.events.EventPlayerDamageBlock;
import com.kisman.cc.features.module.Category;
import com.kisman.cc.features.module.Module;
import com.kisman.cc.features.module.WorkInProgress;
import com.kisman.cc.util.entity.player.InventoryUtil;
import me.zero.alpine.listener.Listener;
import net.minecraft.network.play.client.CPacketHeldItemChange;

@WorkInProgress
public class HandMine extends Module {

    public HandMine(){
        super("HandMine", Category.EXPLOIT);
    }

    private int oldSlot;

    @Override
    public void onEnable(){
        super.onEnable();
        Kisman.EVENT_BUS.subscribe(preListener);
        Kisman.EVENT_BUS.subscribe(postListener);
    }

    @Override
    public void onDisable(){
        super.onDisable();
        Kisman.EVENT_BUS.unsubscribe(preListener);
        Kisman.EVENT_BUS.unsubscribe(postListener);
    }

    private final Listener<EventPlayerDamageBlock.Pre> preListener = new Listener<>(event -> {
        oldSlot = mc.player.inventory.currentItem;
        int slot = InventoryUtil.findBestToolSlot(event.getPos());
        if(slot == -1)
            return;
        mc.player.connection.sendPacket(new CPacketHeldItemChange(slot));
        mc.player.inventory.currentItem = slot;
    });

    private final Listener<EventPlayerDamageBlock.Post> postListener = new Listener<>(event -> {
        mc.player.connection.sendPacket(new CPacketHeldItemChange(oldSlot));
        mc.player.inventory.currentItem = oldSlot;
    });
}
